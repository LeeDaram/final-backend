<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.example.finalEclips.eclips.notice.repository.NoticeMapper">

	<resultMap id="noticeResultMap"
		type="com.example.finalEclips.eclips.notice.dto.NoticeDto">
		<id property="noticeId" column="notice_id" />
		<result property="title" column="title" />
		<result property="content" column="content" jdbcType="CLOB"/>
		<result property="isMainNotice" column="is_main_notice" />
		<result property="createdAt" column="notice_create" />
		<result property="updatedAt" column="notice_update" />
		<collection property="attachments"
			ofType="com.example.finalEclips.eclips.notice.dto.NoticeAttachmentDto">
			<result property="attachmentId" column="attachment_id" />
			<result property="noticeId" column="notice_id" />
			<result property="originFilename" column="origin_filename" />
			<result property="storedFilename" column="stored_filename" />
			<result property="contentType" column="content_type" />
			<result property="fileSize" column="file_size" />
			<result property="createdAt" column="created_at" />
		</collection>
	</resultMap>

	<select id="findAllNotices" resultMap="noticeResultMap">
		SELECT
		      n.NOTICE_ID,
		      n.TITLE,
		      n.CONTENT,
		      n.IS_MAIN_NOTICE,
		      n.CREATED_AT AS notice_create,
		      n.UPDATED_AT AS notice_update,
		      na.ATTACHMENT_ID,
		      na.NOTICE_ID AS attachment_notice_id,
		      na.ORIGIN_FILENAME,
		      na.STORED_FILENAME,
		      na.CONTENT_TYPE,
		      na.FILE_SIZE,
		      na.CREATED_AT AS attachment_create
		FROM NOTICE n 
		LEFT OUTER JOIN NOTICE_ATTACHMENTS na ON n.notice_id = na.notice_id
		 ORDER BY n.IS_MAIN_NOTICE DESC, n.CREATED_AT DESC
	</select>
	
	<select id="findNoticeAttachmentById" resultType="com.example.finalEclips.eclips.notice.dto.NoticeAttachmentDto">
		SELECT
		      ATTACHMENT_ID, 
		      NOTICE_ID,
		      ORIGIN_FILENAME, 
		      STORED_FILENAME, 
		      CONTENT_TYPE, 
		      FILE_SIZE, 
		      CREATED_AT
		FROM NOTICE_ATTACHMENTS
		WHERE ATTACHMENT_ID = #{attachmentId}
	</select>
</mapper>